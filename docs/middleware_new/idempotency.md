<!-- Code generated by gomarkdoc. DO NOT EDIT -->

---
id: idempotency
---


# idempotency

```go
import "github.com/gofiber/fiber/v3/middleware/idempotency"
```

## Index

- [Variables](<#variables>)
- [func IsFromCache\(c fiber.Ctx\) bool](<#IsFromCache>)
- [func New\(config ...Config\) fiber.Handler](<#New>)
- [func WasPutToCache\(c fiber.Ctx\) bool](<#WasPutToCache>)
- [type Config](<#Config>)
- [type Locker](<#Locker>)
- [type MemoryLock](<#MemoryLock>)
  - [func NewMemoryLock\(\) \*MemoryLock](<#NewMemoryLock>)
  - [func \(l \*MemoryLock\) Lock\(key string\) error](<#MemoryLock.Lock>)
  - [func \(l \*MemoryLock\) Unlock\(key string\) error](<#MemoryLock.Unlock>)


## Variables

<a name="ConfigDefault"></a>ConfigDefault is the default config

```go
var ConfigDefault = Config{
    Next: func(c fiber.Ctx) bool {

        return fiber.IsMethodSafe(c.Method())
    },

    Lifetime: 30 * time.Minute,

    KeyHeader: "X-Idempotency-Key",
    KeyHeaderValidate: func(k string) error {
        if l, wl := len(k), 36; l != wl {
            return fmt.Errorf("%w: invalid length: %d != %d", ErrInvalidIdempotencyKey, l, wl)
        }

        return nil
    },

    KeepResponseHeaders: nil,

    Lock: nil,

    Storage:               nil,
    DisableValueRedaction: false,
}
```

<a name="ErrInvalidIdempotencyKey"></a>

```go
var ErrInvalidIdempotencyKey = errors.New("invalid idempotency key")
```

<a name="IsFromCache"></a>
## func IsFromCache

```go
func IsFromCache(c fiber.Ctx) bool
```

IsFromCache reports whether the middleware served the response from the cache for the current request.

<a name="New"></a>
## func New

```go
func New(config ...Config) fiber.Handler
```

New creates idempotency middleware that caches responses keyed by the configured idempotency header.

<a name="WasPutToCache"></a>
## func WasPutToCache

```go
func WasPutToCache(c fiber.Ctx) bool
```

WasPutToCache reports whether the middleware stored the response produced by the current request in the cache.

<a name="Config"></a>
## type Config

Config defines the config for middleware.

```go
type Config struct {
    // Lock locks an idempotency key.
    //
    // Optional. Default: an in-memory locker for this process only.
    Lock Locker

    // Storage stores response data by idempotency key.
    //
    // Optional. Default: an in-memory storage for this process only.
    Storage fiber.Storage

    // Next defines a function to skip this middleware when returned true.
    //
    // Optional. Default: a function which skips the middleware on safe HTTP request method.
    Next func(c fiber.Ctx) bool

    // KeyHeaderValidate defines a function to validate the syntax of the idempotency header.
    //
    // Optional. Default: a function which ensures the header is 36 characters long (the size of an UUID).
    KeyHeaderValidate func(string) error

    // KeyHeader is the name of the header that contains the idempotency key.
    //
    // Optional. Default: X-Idempotency-Key
    KeyHeader string

    // KeepResponseHeaders is a list of headers that should be kept from the original response.
    //
    // Optional. Default: nil (to keep all headers)
    KeepResponseHeaders []string

    // Lifetime is the maximum lifetime of an idempotency key.
    //
    // Optional. Default: 30 * time.Minute
    Lifetime time.Duration

    // DisableValueRedaction turns off masking idempotency keys in logs and errors when set to true.
    //
    // Optional. Default: false
    DisableValueRedaction bool
}
```

<a name="Locker"></a>
## type Locker

Locker implements a spinlock for a string key.

```go
type Locker interface {
    Lock(key string) error
    Unlock(key string) error
}
```

<a name="MemoryLock"></a>
## type MemoryLock

MemoryLock coordinates access to idempotency keys using in\-memory locks.

```go
type MemoryLock struct {
    // contains filtered or unexported fields
}
```

<a name="NewMemoryLock"></a>
### func NewMemoryLock

```go
func NewMemoryLock() *MemoryLock
```

NewMemoryLock creates a MemoryLock ready for use.

<a name="MemoryLock.Lock"></a>
### func \(\*MemoryLock\) Lock

```go
func (l *MemoryLock) Lock(key string) error
```

Lock acquires the lock for the provided key, creating it when necessary.

<a name="MemoryLock.Unlock"></a>
### func \(\*MemoryLock\) Unlock

```go
func (l *MemoryLock) Unlock(key string) error
```

Unlock releases the lock associated with the provided key.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
